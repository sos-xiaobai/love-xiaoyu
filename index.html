<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小鱼同学</title>
    <meta name="language" content="zh-CN">
    <meta name="title" content="小鱼同学">
    <meta name="github" content="">
    <meta name="describe" content=" ">
    <link rel="icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/sun0225SUN/photos/img/20210715233345.png">
    <link rel="stylesheet" href="css/love.css">
</head>

<body>

    <audio autoplay="autopaly" loop="loop" id="audios" preload="auto">
        <source src="MP3/1.mp3" />
    </audio>

    <div class="container" onselectstart="return false;" unselectable="on" style="-moz-user-select:none;">

        <div class="body_left">
            <img src="images/biubiubiu.gif" alt="" ondragstart='return false;'>
        </div>

        <div class="body_center love">
            <div class="block">
                <div class="div1"></div>
                <div class="div2"></div>
                <div class="div3"></div>
                <div class="div4"></div>
            </div>
        </div>
    </div>

    <div class="top-image">
        <img src="images/主动爱心贴贴.gif" alt="">
    </div>

    <div class="footer">
        <div class="border">
            <div class="border-top"></div>
            <div class="border-bottom"></div>
        </div>
    </div>

    <!-- 右下角打字机文字 -->
    <div id="typing-container">
        <p id="typing-text"></p>
        <div id="button-container" style="display: none; margin-top: 15px; text-align: center;">
            <button id="yes-btn" style="margin: 0 10px; padding: 8px 20px; font-size: 16px; background-color: #ff69b4; color: white; border: none; border-radius: 5px; cursor: pointer;">愿意</button>
            <button id="no-btn" style="margin: 0 10px; padding: 8px 20px; font-size: 16px; background-color: #999; color: white; border: none; border-radius: 5px; cursor: pointer;">不愿意</button>
        </div>
        <p id="message-text" style="display: none; font-size: 18px; color: #ff69b4; font-weight: bold; margin-top: 15px;">师兄和小鱼在一起的</p>
        <p id="timer-text" style="display: none; font-size: 50px; color: #ff69b4; font-weight: bold; margin-top: 10px;"></p>
    </div>

    <script type="text/javascript" src="js/love.js"></script>
    <script>
    (function(){
        const STORAGE_KEY = 'love_start_ts';
        const text = "小鱼\n你是我的星辰大海\n你愿意做我的唯一吗？";
        const typingEl = document.getElementById('typing-text');
        const buttonContainer = document.getElementById('button-container');
        const messageEl = document.getElementById('message-text');
        const timerEl = document.getElementById('timer-text');
        const yesBtn = document.getElementById('yes-btn');
        const noBtn = document.getElementById('no-btn');

        let typingIndex = 0;
        let timerInterval = null;

        function formatTime(ms){
            const totalSeconds = Math.floor(ms/1000);
            const days = Math.floor(totalSeconds/86400);
            const hours = Math.floor((totalSeconds%86400)/3600);
            const minutes = Math.floor((totalSeconds%3600)/60);
            const seconds = totalSeconds%60;
            return `${days}天${hours}小时${minutes}分钟${seconds}秒`;
        }

        function startTimerFrom(ts){
            if(timerInterval) clearInterval(timerInterval);
            messageEl.style.display = 'block';
            timerEl.style.display = 'inline-block';
            function update(){
                const elapsed = Date.now() - ts;
                timerEl.textContent = formatTime(elapsed);
            }
            update();
            timerInterval = setInterval(update, 1000);
        }

        function typeText(){
            if(typingIndex < text.length){
                const ch = text[typingIndex++];
                if(ch === '\n') typingEl.innerHTML += '<br>';
                else typingEl.innerHTML += ch;
                setTimeout(typeText, 100);
            } else {
                buttonContainer.style.display = 'block';
            }
        }

        // 入口：如果已保存开始时间，直接显示计时；否则播放打字并显示按钮
        let saved = localStorage.getItem(STORAGE_KEY);
        // 强制重新打字：删除本地存储（发布前删除这一行）
        localStorage.removeItem(STORAGE_KEY);
        saved = null;
        
        if(saved){
            typingEl.style.display = 'none';
            buttonContainer.style.display = 'none';
            startTimerFrom(Number(saved));
        } else {
            // 根据你页面动画时长调整延迟（当前设为 24000ms）
            setTimeout(typeText, 24000);
        }

        yesBtn.addEventListener('click', function(){
            const now = Date.now();
            localStorage.setItem(STORAGE_KEY, String(now));
            typingEl.style.display = 'none';
            buttonContainer.style.display = 'none';
            startTimerFrom(now);
        });

        noBtn.addEventListener('click', function(){
            alert('那我就一直等你！');
        });
    })();
    </script>

</body>
</html>
